import{useRef as e,useState as t,useLayoutEffect as n,useCallback as r}from"react";var u;!function(e){e.ARROW_RIGHT="ArrowRight",e.ARROW_LEFT="ArrowLeft",e.SPACEBAR=" ",e.BACKSPACE="Backspace",e.ENTER="Enter"}(u||(u={}));const c={maxLength:1,required:!1},l=[u.ARROW_LEFT,u.ARROW_RIGHT,u.BACKSPACE,u.SPACEBAR,u.ENTER],a={numeric:"tel",alphanumeric:"text",password:"password","password-numeric":"password"},o=({type:o="alphanumeric",onInputValueChange:s,blankAllowed:i=!1,focusOnLoad:p=!1,autoCompleteAttribute:d="off",defaultInlineStyles:f,cycle:m=!1,placeholder:A="",numberOfInputs:I}={})=>{const h=e({fields:[],uniqueNames:[],currentActiveInputIndex:0,value:"numeric"===o?0:"",totalInputValueLength:0}),[g,v]=t(""),[R,E]=t(""),x=e=>{const t=h.current.fields;if(C(e))return t[e].element.focus(),t[e]},C=e=>e<h.current.fields.length&&e>=0,L=()=>{const e=h.current.currentActiveInputIndex;return h.current.currentActiveInputIndex=C(e+1)?e+1:m?0:e,h.current.currentActiveInputIndex},y=()=>{const e=h.current.currentActiveInputIndex;return h.current.currentActiveInputIndex=C(e-1)?e-1:m?h.current.fields.length-1:e,h.current.currentActiveInputIndex};n(()=>{if(p)try{h.current.fields[0].element.focus()}catch(e){console.error("Cannot find field on load")}h.current.totalInputValueLength=h.current.fields.reduce((e,t)=>e+t.maxLength,0)},[]);const S=(e=0,t)=>{if(t){const n=h.current.fields.length;let r=t.toString().slice(0,n);const u=r.length,c=r;for(let t=e;t<Math.min(n,u);t++){const e=h.current.fields,n=e[t].maxLength;e[t].element.value=r.slice(0,n),r=r.slice(n)}v(c),h.current.value=c}};return{register(e,t=c){const n=t.maxLength?t.maxLength:1;return{autoComplete:d,"aria-label":`otp-input-${e}`,name:`otp-input-${e}`,onKeyDown:e=>{const t=e.target.value,r=e.key;var c;i||r!==u.SPACEBAR||e.preventDefault(),t.length>=n&&r!==u.BACKSPACE&&r!==u.ENTER&&("number"!=typeof(c=e.target).selectionStart||0!=c.selectionStart||c.selectionEnd!=c.value.length)&&e.preventDefault(),"numeric"!==o&&"password-numeric"!==o||/^[\d]$/.test(r)||l.includes(r)||e.preventDefault()},onInput:e=>{const t=e.target.value;t.length>=n&&""!==t&&x(L()),h.current.value=h.current.fields.map(e=>e.element.value).join(""),s&&s(h.current.value),v(h.current.value)},onKeyUp:e=>{const t=e.key;0!==e.target.value.length&&t!==u.ARROW_LEFT&&t!==u.ARROW_RIGHT||(e=>{const t=e.key;t===u.ARROW_LEFT?x(y()):t===u.ARROW_RIGHT?x(L()):t===u.BACKSPACE?x(y()):t===u.SPACEBAR&&e.preventDefault()})(e)},onFocus:e=>{h.current.currentActiveInputIndex=h.current.fields.findIndex(t=>t.element===e.target),e.target.setSelectionRange(0,n)},ref:r(r=>{if(r){const u=r.querySelector("input,textarea");u&&(r=u),t.required&&(r.required=t.required),r.maxLength=n,h.current.uniqueNames.push(e),r instanceof HTMLInputElement&&(r.type=a[o]),h.current.fields.push({element:r,inputName:e,maxLength:n})}},[]),style:f,placeholder:A,onPaste:e=>{const t=e.clipboardData.getData("text");S(h.current.currentActiveInputIndex,t)}}},setValue:e=>{S(0,e)},setDisabled:e=>{h.current.fields.forEach(t=>{t.element.disabled=e})},clear:()=>{h.current.currentActiveInputIndex=0,h.current.fields[h.current.currentActiveInputIndex].element.focus(),h.current.fields.forEach(e=>{e.element.value=""}),v("")},value:g,get inputs(){let e=[];if("number"==typeof I&&I>0){for(let t=0;t<I;t++)e.push(this.register(`num-${t}`));return e}return console.warn("Please provide `numOfInputs` to use the input array map"),[]},error:R,setError:E}};export{o as useOtpInput};
